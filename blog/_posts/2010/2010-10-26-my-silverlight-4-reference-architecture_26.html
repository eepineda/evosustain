---

title: 'Silverlight Cookbook: ViewModels, Coroutines and Binding Conventions'
date: '2010-10-26T22:19:00.001+02:00'

tags:
- dotnetmag
- Cookbook
- Architecture
- Silverlight
modified_time: '2011-05-15T19:08:26.406+02:00'
thumbnail: http://lh4.ggpht.com/_sv2gnsft17w/TMc32ygF2mI/AAAAAAAAGy4/fMqvd8Eit9c/s72-c/clip_image001_thumb%5B2%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-15137028.post-4577995880636482884
blogger_orig_url: http://www.continuousimprover.com/2010/10/my-silverlight-4-reference-architecture_26.html
---

<p>This post is part of a series of <a href="http://www.dennisdoomen.net/search/label/Cookbook">blog posts</a> detailing various aspects of the <a href="http://www.silverlightcookbook.com">Silverlight Cookbook</a>, an initiative to demonstrate proper design choices for building enterprise-class line-of-business applications with Silverlight (and WPF if you will). It currently consists out of the following parts.</p>  <ul>   <li><a href="http://www.dennisdoomen.net/2011/03/introducing-silverlight-cookbook.html">Introduction</a></li>    <li><a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture_26.html">View Models, Coroutines and Binding Conventions</a></li> </ul>  <ul>   <li><a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture_13.html">Domain Models and Domain Events</a></li>    <li><a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture_12.html">Querying</a></li> </ul>  <ul>   <li><a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture.html">Commanding</a></li>    <li><a href="http://www.dennisdoomen.net/2010/09/some-thoughts-on-wcf-data-services-and.html">WCF Data Services &amp; NHibernate</a></li>    <li><a href="http://www.dennisdoomen.net/2010/09/getting-more-out-of-unit-testing-in.html">BDD-Style Unit Testing of View Models</a></li> </ul>  <ul>   <li><a href="http://www.dennisdoomen.net/2011/01/verifying-propertychanged-events-in.html">Verifying PropertyChanged events using Fluent Assertions</a></li> </ul>  <p>After having covered <a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture_12.html">querying</a>, <a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture.html">commanding</a> and the <a href="http://www.dennisdoomen.net/2010/10/my-silverlight-4-reference-architecture_13.html">domain model</a>, it is time for discussing some of the Silverlight application details. But before I do that, let's list the components I currently use: </p>  <ul>   <li>The <a href="http://silverlight.codeplex.com/">Silverlight Toolkit</a> for all those extra nifty controls; </li>    <li><a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyId=03020964-57f3-4893-9e6c-3b1c281432c8&amp;displaylang=en">Unity 2 for Silverlight</a> as my preferred IoC container; </li>    <li>The official <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=e9da0eb8-f31b-4490-85b8-92c2f807df9e&amp;displaylang=en">application themes</a> for Silverlight; </li>    <li><a href="http://caliburnmicro.codeplex.com/">Caliburn Micro</a> to ease developing using the Model-View-ViewModel pattern and to handle the complexities of asynchronous programming. </li>    <li><a href="http://code.google.com/p/fakeiteasy/">FakeItEasy</a> for, well, mocking. </li>    <li><a href="http://fluentassertions.codeplex.com/">Fluent Assertions</a> for improving the readability of my unit tests.</li> </ul>  <p>Consider the client part of my reference architecture </p>  <p><a href="http://lh3.ggpht.com/_sv2gnsft17w/TMc32GvHLlI/AAAAAAAAGyw/iOG29SQRI30/s1600-h/clip_image001%5B5%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="clip_image001" border="0" alt="clip_image001" src="http://lh4.ggpht.com/_sv2gnsft17w/TMc32ygF2mI/AAAAAAAAGy4/fMqvd8Eit9c/clip_image001_thumb%5B2%5D.png?imgmax=800" width="510" height="218" /></a> </p>  <p><strong>Shell</strong> </p>  <p>The first essential part of every application is the <strong>Shell</strong>. It's a placeholder for all UI behavior related to menu bars, error messages, last-chance exception handling and the Master-page equivalent for Silverlight. Originally, I was planning to use the Regions and Views concept such as provided the <a href="http://msdn.microsoft.com/en-us/library/dd458868.aspx">Composite Application Guidance</a> (CAG) block of <a href="http://msdn.microsoft.com/en-us/library/ff648611.aspx">Prism</a>. But once I started working with the combination of Caliburn Micro (CM) and the Silverlight Business Navigation project template and added one of the awesome free <a href="http://timheuer.com/blog/archive/2010/05/03/new-silverlight-4-themes-available-for-download.aspx">themes</a>, I never needed something like that anymore. As a nice bonus, the Business Navigation template already handles deep linking and back/forward support for you. And if you're building a Line-of-Business application, check out the new <a href="http://timheuer.com/blog/archive/2010/09/09/silverlight-jetpack-theme-released.aspx">Jetpack</a> theme. It's excellent for exactly that purpose. </p>  <p>If you don't want to use the Business Navigation template, CM offers a complete <a href="http://caliburnmicro.codeplex.com/wikipage?title=Screens%2c%20Conductors%20and%20Composition&amp;referringTitle=Documentation">solution</a> consisting of a Screen class representing the ViewModel of a XAML page or a user control, and a Conductor class that represents the Shell and allows activating and deactivating individual screens. The out-of-the-box conductor only allows having one active screen (aka SDI), but it is quite trivial to support an MDI-style application because the CM design is very extensible. For instance, the Screen class implements a whole bunch of interfaces that allows your ViewModel to hook in its life-cycle. Examples of those interfaces include IActivate, IDeactivate, IGuardClose and IChild. Notice that this approach is based on the ViewModel-first concept. In other words, you are always activating ViewModels where CM will use conventions to figure out which XAML page, XAML fragment or User Control to display. </p>  <p>In the case of the Business Navigation template, the conductor functionality is handled by a Silverlight Frame control. CM provides a FrameAdapter class that makes sure that the above mentioned life-cycle notifications are also applied to ViewModels that are associated with the XAML pages that the Frame control loads. As such CM supports both a ViewModel-first approach as well as View-first. </p>  <p><strong>ViewModels</strong> </p>  <p>Obviously, no serious developer will build a Silverlight application without applying the <a href="http://msdn.microsoft.com/en-us/magazine/dd419663.aspx">Model-View-ViewModel</a> pattern. Let's start with the code that is involved when loading a view. It's from <a href="http://thecqrskitchen.codeplex.com/">The CQRS Kitchen</a> demo and represent the ViewModel for a view that is used to search for recipes.     <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">class</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">SearchViewModel</font></span><span style="color: "> : </span></font><span style="color: "><font style="font-size: 11pt" color="#00008b">Screen</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [</font></span><font style="font-size: 11pt"><span style="color: "><font color="#00008b">Dependency</font></span></font><span style="color: "><font style="font-size: 11pt">]</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IApplicationController</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">ApplicationController</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [</font></span><font style="font-size: 11pt"><span style="color: "><font color="#00008b">Dependency</font></span></font><span style="color: "><font style="font-size: 11pt">]</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IQueryAgent</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">QueryAgent</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">void</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">OnInitialize</font></span></font><span style="color: "><font style="font-size: 11pt">()</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">MinimumRating</font></span></font><span style="color: "><font style="font-size: 11pt"> = 0;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">PartialDescription</font></span><span style="color: "> = </span><span style="color: "><font color="#a31515">&quot;&quot;</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">PartialName</font></span><span style="color: "> = </span><span style="color: "><font color="#a31515">&quot;&quot;</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p>The first thing to notice is the base-class this ViewModel is deriving from. It extends CM's Screen class, which offers a way for raising the INotifyPropertyChange using type-safe expressions instead of using literal strings, and implements all the plumbing needed for hooking into the life-cycle interfaces CM offers. You don't necessarily need to derive your ViewModels from Screen and can implement those interfaces directly, but using the Screen class prevents your ViewModel from becoming too obscure. </p>  <p>The OnInitialize method is one of those life-cycle methods I mentioned before but is not doing anything useful in this particular case other than setting the defaults for the search fields. Notice the use of the NotifyOfPropertyChange method in the property setters below. That's the PropertyChangedBase class in action where Screen is deriving from. It will raise the corresponding NotifyPropertyChanged event, and make sure it is raised from the UI thread, regardless of the thread you called NotifyOfPropertyChange from.    <br />    <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">string</font></span><span style="color: ">&#160;</span></font><span style="color: "><font style="font-size: 11pt" color="#800080">PartialName</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">get</font></span><span style="color: "> { </span><span style="color: "><font color="#0000ff">return</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">partialName</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font style="font-size: 11pt" color="#008b8b">set</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">partialName</font></span><span style="color: "> = </span><span style="color: "><font color="#0000ff">value</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">NotifyOfPropertyChange</font></span><span style="color: ">(() =&gt; </span><span style="color: "><font color="#800080">PartialName</font></span></font><span style="color: "><font style="font-size: 11pt">);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">string</font></span><span style="color: ">&#160;</span></font><span style="color: "><font style="font-size: 11pt" color="#800080">PartialDescription</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">get</font></span><span style="color: "> { </span><span style="color: "><font color="#0000ff">return</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">partialDescription</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font style="font-size: 11pt" color="#008b8b">set</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">partialDescription</font></span><span style="color: "> = </span><span style="color: "><font color="#0000ff">value</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">NotifyOfPropertyChange</font></span><span style="color: ">(() =&gt; </span><span style="color: "><font color="#800080">PartialDescription</font></span></font><span style="color: "><font style="font-size: 11pt">);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">double</font></span><span style="color: ">&#160;</span></font><span style="color: "><font style="font-size: 11pt" color="#800080">MinimumRating</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">get</font></span><span style="color: "> { </span><span style="color: "><font color="#0000ff">return</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">minimumRating</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><span style="color: "><font style="font-size: 11pt" color="#008b8b">set</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">minimumRating</font></span><span style="color: "> = </span><span style="color: "><font color="#0000ff">value</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">NotifyOfPropertyChange</font></span><span style="color: ">(() =&gt; </span><span style="color: "><font color="#800080">MinimumRating</font></span></font><span style="color: "><font style="font-size: 11pt">);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p>The code also shows some dependencies this particular ViewModel has on other application-specific services. In the reference architecture, the <strong>ApplicationController</strong> is responsible for navigating to other views or dialog windows and knows the URLs of their XAML files. This way I can verify the navigation behavior of the ViewModel without the need to know anything about the actual URL or the required query parameters. </p>  <p>In this demo application I use Unity to handle dependency injection, but CM can be extended to use any IoC framework by overriding the appropriate methods in the class that inherits from the <strong>Bootstrapper</strong> class:     <br />    <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">class</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">ClientBootstrapper</font></span><span style="color: "> : </span><span style="color: "><font color="#00008b">Bootstrapper</font></span><span style="color: ">&lt;</span><span style="color: "><font color="#00008b">ShellViewModel</font></span></font><span style="color: "><font style="font-size: 11pt">&gt;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">private</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">readonly</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IUnityContainer</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">container</font></span><span style="color: "> = </span><span style="color: "><font color="#0000ff">new</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">UnityContainer</font></span></font><span style="color: "><font style="font-size: 11pt">();</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">void</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">Configure</font></span></font><span style="color: "><font style="font-size: 11pt">()</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in 0in 0in 0.375in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font color="#008000"><font style="font-size: 11pt">// Setting up the Unity container left out for brevity...</font></font></span><span style="color: "><font style="font-size: 11pt"> </font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">object</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">GetInstance</font></span><span style="color: ">(</span><span style="color: "><font color="#00008b">Type</font></span><span style="color: "> service, </span><span style="color: "><font color="#0000ff">string</font></span></font><span style="color: "><font style="font-size: 11pt"> key)</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">if</font></span><span style="color: "> (service == </span><span style="color: "><font color="#0000ff">null</font></span></font><span style="color: "><font style="font-size: 11pt">)</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; service = </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">GetViewModelTypeNameFromKey</font></span></font><span style="color: "><font style="font-size: 11pt">(key);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; key = </font></span><font style="font-size: 11pt"><span style="color: "><font color="#a31515">&quot;&quot;</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">return</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">container</font></span><span style="color: ">.</span><span style="color: "><font color="#008b8b">Resolve</font></span></font><span style="color: "><font style="font-size: 11pt">(service, key);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font color="#000000"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">private</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#0000ff">static</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#00008b">Type</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#008b8b">GetViewModelTypeNameFromKey</font></span><font color="#000000">(</font><span style="color: "><font color="#0000ff">string</font></span><font color="#000000"> key)</font></font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font color="#000000"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">var</font></span><font color="#000000"> viewModelType = </font><span style="color: "><font color="#0000ff">from</font></span><font color="#000000"> type </font><span style="color: "><font color="#0000ff">in</font></span><font color="#000000">&#160;</font><span style="color: "><font color="#0000ff">typeof</font></span><font color="#000000">(</font><span style="color: "><font color="#00008b">ShellViewModel</font></span><font color="#000000">).</font><span style="color: "><font color="#800080">Assembly</font></span><font color="#000000">.</font><span style="color: "><font color="#008b8b">GetTypes</font></span><font color="#000000">()</font></font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font color="#000000"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">where</font></span><font color="#000000"> type.</font><span style="color: "><font color="#800080">Name</font></span><font color="#000000">.</font><span style="color: "><font color="#008b8b">Equals</font></span><font color="#000000">(key, </font><span style="color: "><font color="#00008b">StringComparison</font></span><font color="#000000">.</font><span style="color: "><font color="#800080"><strong>InvariantCultureIgnoreCase</strong></font></span><font color="#000000">)</font></font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font color="#000000"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">select</font></span><font color="#000000"> type;</font></font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font color="#000000"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></font><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">return</font></span><font color="#000000"> viewModelType.</font><span style="color: "><font color="#008b8b">SingleOrDefault</font></span><font color="#000000">();</font></font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IEnumerable</font></span><span style="color: ">&lt;</span><span style="color: "><font color="#0000ff">object</font></span><span style="color: ">&gt; </span><span style="color: "><font color="#008b8b">GetAllInstances</font></span><span style="color: ">(</span><span style="color: "><font color="#00008b">Type</font></span></font><span style="color: "><font style="font-size: 11pt"> service)</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">return</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">container</font></span><span style="color: ">.</span><span style="color: "><font color="#008b8b">ResolveAll</font></span></font><span style="color: "><font style="font-size: 11pt">(service);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">void</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">BuildUp</font></span><span style="color: ">(</span><span style="color: "><font color="#0000ff">object</font></span></font><span style="color: "><font style="font-size: 11pt"> instance)</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">container</font></span><span style="color: ">.</span><span style="color: "><font color="#008b8b">BuildUp</font></span><span style="color: ">(instance.</span><span style="color: "><font color="#008b8b">GetType</font></span></font><span style="color: "><font style="font-size: 11pt">(), instance);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; }</font></font></p>  <p><strong>Coroutines</strong> </p>  <p>So let's look at the code that searches for existing recipes.   <br />    <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IEnumerable</font></span><span style="color: ">&lt;</span><span style="color: "><font color="#00008b">IResult</font></span><span style="color: ">&gt; </span><span style="color: "><font color="#008b8b">FindRecipes</font></span></font><span style="color: "><font style="font-size: 11pt">()</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">var</font></span><span style="color: "> coroutine = </span><span style="color: "><font color="#0000ff">new</font></span><span style="color: ">&#160;</span></font><span style="color: "><font style="font-size: 11pt" color="#00008b">FindRecipesCoroutine</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">PartialName</font></span><span style="color: "> = </span><span style="color: "><font color="#800080">partialName</font></span></font><span style="color: "><font style="font-size: 11pt">,</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">PartialDescription</font></span><span style="color: "> = </span><span style="color: "><font color="#800080">partialDescription</font></span></font><span style="color: "><font style="font-size: 11pt">,</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">MinimumRating</font></span><span style="color: "> = (</span><span style="color: "><font color="#0000ff">int</font></span><span style="color: ">)(</span><span style="color: "><font color="#800080">minimumRating</font></span><span style="color: "> * </span><span style="color: "><font color="#800080"><strong>MaxRating</strong></font></span></font><span style="color: "><font style="font-size: 11pt">)</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; };</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">yield</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">return</font></span></font><span style="color: "><font style="font-size: 11pt"> coroutine;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">Recipes</font></span><span style="color: "> = coroutine.</span><span style="color: "><font color="#800080">Recipes</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p>It should look rather unconventional, especially the usage of the yield keyword and the reference to the IResult interface in the return type declaration. This interface is part of CM and defined as:    <br />    <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">interface</font></span><span style="color: ">&#160;</span></font><span style="color: "><font style="font-size: 11pt" color="#00008b">IResult</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">void</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">Execute</font></span><span style="color: ">(</span><span style="color: "><font color="#00008b">ActionExecutionContext</font></span></font><span style="color: "><font style="font-size: 11pt"> context);</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">event</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">EventHandler</font></span><span style="color: ">&lt;</span><span style="color: "><font color="#00008b">ResultCompletionEventArgs</font></span><span style="color: ">&gt; </span><span style="color: "><font color="#ff00ff">Completed</font></span></font><span style="color: "><font style="font-size: 11pt">;</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; }</font></font></p>  <p>You can easily deduce from this definition that a class implementing this interface is supposed to do something upon calling Execute and should notify the caller when that is finished. In essence, this is an asynchronous version of the <a href="http://en.wikipedia.org/wiki/Command_pattern">Command Pattern</a>, but most people refer to it as a <strong>Coroutine</strong>. CM will assume that all ViewModel methods that return an IEnumerable of IResult are doing asynchronous work and will ensure that the Execute method of a coroutine is not executed until the previous one has completed. The compiler will do the rest. Why? </p>  <p>Well, this is probably the first time I've actually found good use of the yield keyword. Because what happens here is that the compiler will generate a hidden class for the FindRecipes method. This class implements IEnumerable and breaks the method body into two steps that are executing sequentially as part of each IEnumerable.Next call. As such, the first step will construct the FindRecipesCoroutine class and return it. CM will then invoke its Execute method and wait until its Completed event has completed. Only then, it will continue enumerating and cause the code following the yield to execute. By returning multiple coroutines you can create a kind of mini-workflow because the compiler and CM will ensure everything is executed in the right order. That is awesome, isn't it!? </p>  <p>The coroutine itself is not that complex.    <br />    <br /></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">class</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">FindRecipesCoroutine</font></span><span style="color: "> : </span></font><span style="color: "><font style="font-size: 11pt" color="#00008b">SimpleCoroutine</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; [</font></span><font style="font-size: 11pt"><span style="color: "><font color="#00008b">Dependency</font></span></font><span style="color: "><font style="font-size: 11pt">]</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IQueryAgent</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">QueryAgent</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">string</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">PartialName</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">string</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">PartialDescription</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">int</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#800080">MinimumRating</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">public</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#00008b">IEnumerable</font></span><span style="color: ">&lt;</span><span style="color: "><font color="#00008b">Recipe</font></span><span style="color: ">&gt; </span><span style="color: "><font color="#800080">Recipes</font></span><span style="color: "> { </span><span style="color: "><font color="#008b8b">get</font></span><span style="color: ">; </span><span style="color: "><font color="#0000ff">internal</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">set</font></span></font><span style="color: "><font style="font-size: 11pt">; }</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: "><font face="Calibri"><font style="font-size: 11pt" color="#000000">&#160;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#0000ff">protected</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">override</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#0000ff">void</font></span><span style="color: ">&#160;</span><span style="color: "><font color="#008b8b">OnExecute</font></span></font><span style="color: "><font style="font-size: 11pt">()</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">QueryAgent</font></span><span style="color: ">.</span><span style="color: "><font color="#008b8b">FindRecipes</font></span><span style="color: ">(</span><span style="color: "><font color="#800080">MinimumRating</font></span><span style="color: ">, </span><span style="color: "><font color="#800080">PartialName</font></span><span style="color: ">, </span><span style="color: "><font color="#800080">PartialDescription</font></span></font><span style="color: "><font style="font-size: 11pt">,</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; recipes =&gt;</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#800080">Recipes</font></span><span style="color: "> = recipes.</span><span style="color: "><font color="#008b8b">ToArray</font></span></font><span style="color: "><font style="font-size: 11pt">();</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: " lang="en-US"><font face="Calibri"><span style="color: "><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></span><font style="font-size: 11pt"><span style="color: "><font color="#008b8b">OnComplete</font></span></font><span style="color: "><font style="font-size: 11pt">();</font></span></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; });</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></font></p>  <p style="line-height: normal; margin: 0in; font-family: ; color: " lang="en-US"><font face="Calibri"><font style="font-size: 11pt">&#160;&#160;&#160; }</font></font></p>  <p>It's just a thin wrapper that calls a facade hiding the complexities (ugliness) of using WCF Data Services. And since we can rely on CM to inject any dependencies using the configure IoC container, even this class is easily testable. Notice the SimpleCoroutine template class. It's something I created myself to get rid of the repeating code required for declaring and raising the Completed event. The <a href="http://thecqrskitchen.codeplex.com/">CQRS Kitchen</a> demo also includes a ComplexCoroutine that allows using multiple yield return statements in the OnExecute method to wrap mini-workflows into a coroutine. </p>  <p>In this case, the Recipes property simply exposes the Recipe objects that were generated by the Add Service Reference context menu option of Visual Studio. Because those classes implement INotifyPropertyChanged, In most cases that is sufficient for all kinds of tracking purposes. However, sometimes you have to add some derived properties that are specific to the ViewModel. In usually extend the generated class and add whatever I need for my particular situation and postfix that class with Model. That signifies the fact that I see those classes a part of my ViewModel. </p>  <p><strong>Binding Conventions </strong></p>  <p>You may have noticed the lack of any logic that handles or returns instances of ICommand as you'll find in many <a href="http://johnpapa.net/silverlight/5-simple-steps-to-commanding-in-silverlight/">other</a> MVVM examples. In fact, I never explained how the XAML view gets attached to the ViewModel, and where this ViewModel instance is created in the first place. This is all part of CM's convention-based binding. </p>  <p>In short, regardless of whether you go for View-first or ViewModel-first, CM will ensure that the ViewModel instance is set as the DataContext of the view, that its dependencies are injected, and that the implemented lifecycle interfaces are called. Additionally, CM will automatically bind UI controls to the ViewModel properties based on the control's name. The specific control property and UI event part of that binding is defined by CM's ConventionManager class, and can be easily changed. Just check out the <a href="http://thecqrskitchen.codeplex.com/SourceControl/changeset/view/62745#1609336">ClientBootstrapper</a> on CodePlex. </p>  <p>The same applies to invoking methods on the ViewModel. By default, CM will relate buttons with a particular name to the corresponding equally named method (which may or may not use coroutines). It even supports passing the values of other UI elements as the parameters of that method, again by matching their names. And if your ViewModel has a boolean property or method with the same name, but prefixed with <em>Can</em>, then CM will use that to dynamically disable and enable the corresponding button. Morever, using event triggers, you can hook up methods to virtually any UI control event available. </p>  <p>Rob Eisenberg, the author of CM, has written some pretty elaborate articles demonstrating the power of his convention-based binding. Read the <a href="http://caliburnmicro.codeplex.com/wikipage?title=Basic%20Configuration%2c%20Actions%20and%20Conventions&amp;referringTitle=Documentation">introduction</a> first and then continue with the stuff about the <a href="http://caliburnmicro.codeplex.com/wikipage?title=All%20About%20Actions&amp;referringTitle=Documentation">actions</a>. </p>  <p><strong>Miscellaneous goodies</strong> </p>  <p>For a long while I have been wishing Patterns &amp; Practices would develop a version of the <a href="http://msdn.microsoft.com/en-us/library/ff664572(v=PandP.50).aspx">Policy Injection Application Block</a> suitable for Silverlight. But recently, a community member came up with a <a href="http://caliburnmicro.codeplex.com/wikipage?title=Action%20Filters&amp;referringTitle=Documentation">CM extension</a> that looks similar to the <a href="http://www.asp.net/mvc/tutorials/understanding-action-filters-cs">Action Filters</a> concept in ASP.NET MVC. With that you can apply attributes to your ViewModel properties and methods like [Async], [Rescue], [SetBusy], [Dependencies] or anything else you can come up with yourself. <a href="http://thecqrskitchen.codeplex.com/">The CQRS Kitchen</a> is not using this yet, but thats one of things I plan to the next weeks. </p>  <p>Another little gem for which I'm quite happy CM provided a solution, is its IObservableCollection&lt;T&gt; interface and the corresponding BindableCollection&lt;T&gt;. Now it's finally possible to expose a collection that implements INotifyCollectionChanged, without exposing the actual collection class itself. I'm one of those guys that tries to restrict any collection properties to Ienumerable&lt;T&gt;, so having IObservableCollection is a great life saver. But it gets better. The BindableCollection will automatically raise its events from the UI thread, even if you add or remove items from a background thread. </p>  <p>Well, this post has ended up being a bit longer than I expected, and Im not done yet, so keep checking back once in a while. Topics I have in mind include at least UI validation, the service agent and event aggregation.</p>  